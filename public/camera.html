<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mobile Camera</title>
  <style>
    body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; padding-top: 40px; }
    video { margin: 20px auto; display: block; border: 2px solid #fff; }
    button { margin-top: 30px; padding: 10px 32px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>Camera Capture</h1>
  <video id="video" width="320" height="240" autoplay playsinline></video>
  <br/>
  <button id="start-btn">Start Capturing</button>
  <button id="stop-btn">Stop</button>
  <script>
    const video = document.getElementById('video');
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');
    let stream;
    let captureInterval;
    // Access camera
    async function startCamera() {
      stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
    }
    startCamera();
    function captureAndSend() {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth || 320;
      canvas.height = video.videoHeight || 240;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(async (blob) => {
        const formData = new FormData();
        formData.append('image', blob, 'frame.jpg');
        await fetch('/upload', { method: 'POST', body: formData });
      }, 'image/jpeg');
    }
    startBtn.onclick = function () {
      if (captureInterval) clearInterval(captureInterval);
      captureAndSend(); // Immediate capture
      captureInterval = setInterval(captureAndSend, 8000);
    };
    stopBtn.onclick = function () {
      if (captureInterval) clearInterval(captureInterval);
    };
  </script>
</body>
</html>
